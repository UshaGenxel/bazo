document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".wp-block-bazo-event-grid").forEach(e=>{const t=e.querySelector(".bazo-event-grid"),a=e.querySelector(".bazo-event-load-more"),n=e.querySelector(".bazo-load-more-button"),o=e.querySelectorAll(".bazo-event-filter-button"),r=e.querySelector(".bazo-event-filter-icon-button"),s=e.querySelector(".bazo-event-filters");let c=1;const i=e.getAttribute("data-posts-to-show"),l=e.getAttribute("data-post-type"),d=e.getAttribute("data-taxonomy");let p=JSON.parse(e.getAttribute("data-selected-categories")||"[]"),g=a?parseInt(a.getAttribute("data-max-pages")):1;function u(){n&&(n.style.display=c>=g?"none":"block")}function v(){o.forEach(e=>{const t=e.getAttribute("data-term");"all"===t?e.classList.toggle("active",0===p.length):e.classList.toggle("active",p.includes(parseInt(t)))})}function b(e=!1){let a=`/bazo/wp-json/wp/v2/${l}?per_page=${i}&page=${c}`;p.length&&(a+=`&${d}=${p.join(",")}`),fetch(a).then(e=>(g=e.headers.get("X-WP-TotalPages")?parseInt(e.headers.get("X-WP-TotalPages")):1,e.json())).then(a=>{e&&(t.innerHTML=""),0===a.length?e&&(t.innerHTML="<p>No events found.</p>"):a.forEach(e=>{console.log("Fetched data:",e);const a=document.createElement("div");a.className="bazo-event-card";const n=e.taxonomy_terms&&Array.isArray(e.taxonomy_terms)?e.taxonomy_terms.map(e=>`<span class="bazo-event-category">${e.name}</span>`).join(" "):"",o=e.excerpt&&e.excerpt.rendered?e.excerpt.rendered.replace(/(<([^>]+)>)/gi,""):"",r=o.split(/\s+/).slice(0,10).join(" ")+(o.split(/\s+/).length>10?"...":"");a.innerHTML=`\n                                <a href="${e.link}">\n                                    ${e.featured_media_url?`<div class="bazo-event-card-image"><img src="${e.featured_media_url}" alt=""/></div>`:""}\n                                    <div class="bazo-event-card-content">\n                                        <p class="bazo-event-card-category">${n}</p>\n                                        <h3>${e.title.rendered}</h3>\n                                        ${e.event_date?`<p class="bazo-event-card-date">${e.event_date}</p>`:""}\n                                        ${e.event_time?`<p class="bazo-event-card-date">${e.event_time}</p>`:""}\n                                        <samp class="bazo-event-card-short-description">${r}</samp>\n                                    </div>\n                                </a>\n                            `,t.appendChild(a)}),u()}).catch(e=>console.error("Error fetching events:",e))}u(),v(),n&&n.addEventListener("click",function(){c++,b()}),r&&s&&r.addEventListener("click",function(){s.classList.toggle("is-visible")}),o.forEach(t=>{t.addEventListener("click",function(){const t=this.getAttribute("data-term");p="all"===t?JSON.parse(e.getAttribute("data-selected-categories")||"[]"):[parseInt(t)],v(),c=1,b(!0)})})})});
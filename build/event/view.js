document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".wp-block-bazo-event-grid").forEach(e=>{const t=e.querySelector(".bazo-event-grid"),a=e.querySelector(".bazo-event-load-more"),n=e.querySelector(".bazo-load-more-button"),s=e.querySelectorAll(".bazo-event-filter-button"),o=e.querySelector(".bazo-event-filter-icon-button"),r=e.querySelector(".bazo-event-filters"),i=e.querySelector(".bazo-event-filter-close"),c=e.querySelector(".bazo-event-loader");let l=1;const d=e.getAttribute("data-posts-to-show"),p=e.getAttribute("data-post-type"),u=e.getAttribute("data-taxonomy"),v=JSON.parse(e.getAttribute("data-show-loader")||"true"),g=JSON.parse(e.getAttribute("data-show-ads")||"true"),b=JSON.parse(e.getAttribute("data-ad-positions")||"[]"),m=e.getAttribute("data-placeholder-url")||"/wp-content/themes/bazo/assets/images/placeholder.png";let h=JSON.parse(e.getAttribute("data-selected-categories")||"[]"),f=a?parseInt(a.getAttribute("data-max-pages")):1;function y(){c&&v&&(c.style.display="flex")}function z(){c&&v&&(c.style.display="none")}function $(){n&&(n.style.display=l>=f?"none":"block")}function _(){s.forEach(e=>{const t=e.getAttribute("data-term");"all"===t?e.classList.toggle("active",0===h.length):e.classList.toggle("active",h.includes(parseInt(t)))})}function A(e=!1){y();let a=`/wp-json/wp/v2/${p}?per_page=${d}&page=${l}`;h.length&&(a+=`&${u}=${h.join(",")}`),fetch(a).then(e=>(f=e.headers.get("X-WP-TotalPages")?parseInt(e.headers.get("X-WP-TotalPages")):1,e.json())).then(a=>{e&&(t.innerHTML=""),0===a.length?e&&(t.innerHTML="<p>No events found.</p>"):(function(e,t=0){if(!g||0===b.length)return e;const a=[...e];let n=0;return b.forEach(e=>{const s=e.position-t;if(s>0&&s<=a.length){const t=function(e){const t=document.createElement("div");return t.className=`bazo-ad-block bazo-ad-span-${e.span}`,t.innerHTML=`\n                <div class="bazo-ad-content">\n                    <span class="bazo-ad-text">${e.text}</span>\n                </div>\n            `,t}(e);a.splice(s+n,0,t),n++}}),a}(a.map(e=>{const t=document.createElement("div");t.className="bazo-event-card";const a=e.taxonomy_terms&&Array.isArray(e.taxonomy_terms)?e.taxonomy_terms.map(e=>`<span class="bazo-event-category">${e.name}</span>`).join(" "):"",n=e.excerpt&&e.excerpt.rendered?e.excerpt.rendered.replace(/(<([^>]+)>)/gi,""):"",s=n.split(/\s+/).slice(0,10).join(" ")+(n.split(/\s+/).length>10?"...":"");return t.innerHTML=`\n                                <a href="${e.link}">\n                                    <div class="bazo-event-card-image">\n                                        ${e.featured_media_url?`<img src="${e.featured_media_url}" alt=""/>`:`<img src="${m}" alt="Event placeholder" />`}\n                                    </div>\n                                    <div class="bazo-event-card-content">\n                                        <p class="bazo-event-card-category">${a}</p>\n                                        <h3>${e.title.rendered}</h3>\n                                        ${e.event_date?`<p class="bazo-event-card-date">${e.event_date}</p>`:""}\n                                        ${e.event_time?`<p class="bazo-event-card-date">${e.event_time}</p>`:""}\n                                        <samp class="bazo-event-card-short-description">${s}</samp>\n                                    </div>\n                                </a>\n                                <div class="wishlist-wrap">\n                                    ${e.wishlist_html?e.wishlist_html:""}\n                                </div>\n                            `,t}),e?0:(l-1)*d).forEach(e=>{t.appendChild(e)}),"function"==typeof tinvwl_add_to_wishlist&&tinvwl_add_to_wishlist()),$(),z()}).catch(e=>{console.error("Error fetching events:",e),z()})}$(),_(),v&&c&&(y(),setTimeout(()=>{z()},500)),n&&n.addEventListener("click",function(){l++,A()}),o&&r&&o.addEventListener("click",function(){r.classList.toggle("is-visible")}),i&&r&&i.addEventListener("click",function(){r.classList.remove("is-visible")}),s.forEach(t=>{t.addEventListener("click",function(){const t=this.getAttribute("data-term");h="all"===t?JSON.parse(e.getAttribute("data-selected-categories")||"[]"):[parseInt(t)],_(),r&&r.classList.remove("is-visible"),l=1,A(!0)})})})});